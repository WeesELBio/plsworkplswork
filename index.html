<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Revision Program</title>
    <style>
        body {
            font-family: Arial;
            max-width: 900px;
            margin: auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        #menu {
            border: 1px solid #ccc;
            padding: 10px;
        }

        details {
            margin-bottom: 6px;
        }

        #modeBox {
            margin: 15px 0;
        }

        #answers button {
            display: block;
            width: 100%;
            margin: 6px 0;
        }

        #buttons {
            margin-top: 10px;
        }

        .correct {
            background-color: #b6f7b6;
        }

        .wrong {
            background-color: #f7b6b6;
        }
    </style>
</head>
<body>

<h1>Revision Program</h1>

<!-- TOPIC MENU -->
<div id="menu"></div>

<!-- MODE -->
<div id="modeBox">
    <label>
        <input type="radio" name="mode" value="normal" checked>
        Normal
    </label>
    <label>
        <input type="radio" name="mode" value="hard">
        Hard
    </label>
</div>

<!-- QUESTION -->
<h2 id="questionText"></h2>

<!-- ANSWERS -->
<div id="answers"></div>

<!-- BUTTONS -->
<div id="buttons">
    <button onclick="checkAnswer()">Check Answer</button>
    <button onclick="nextQuestion()">Next Question</button>
</div>

<p id="feedback"></p>

<script>
let questions = {};
let currentQuestion = null;
let selectedAnswer = null;
let shownQuestions = []; // Track questions already shown

// Load JSON questions
fetch("questions.json")
    .then(r => r.json())
    .then(data => {
        questions = data;
        buildMenu();
        nextQuestion(); // Auto-load first question
    });

// Build collapsible topic menu with checkboxes
function buildMenu() {
    const menu = document.getElementById("menu");

    for (let subject in questions) {
        const subjectDetails = document.createElement("details");
        subjectDetails.open = true;

        const subjectSummary = document.createElement("summary");
        subjectSummary.textContent = subject;
        subjectDetails.appendChild(subjectSummary);

        for (let topic in questions[subject]) {
            const topicDetails = document.createElement("details");

            const topicSummary = document.createElement("summary");
            topicSummary.textContent = topic;
            topicDetails.appendChild(topicSummary);

            for (let sub in questions[subject][topic]) {
                const id = `${subject}-${topic}-${sub}`;

                const cb = document.createElement("input");
                cb.type = "checkbox";
                cb.checked = true;
                cb.id = id;

                const label = document.createElement("label");
                label.htmlFor = id;
                label.textContent = " " + sub;

                topicDetails.appendChild(cb);
                topicDetails.appendChild(label);
                topicDetails.appendChild(document.createElement("br"));
            }

            subjectDetails.appendChild(topicDetails);
        }

        menu.appendChild(subjectDetails);
    }
}

// Get all selected questions
function getPool() {
    let pool = [];

    for (let subject in questions) {
        for (let topic in questions[subject]) {
            for (let sub in questions[subject][topic]) {
                const id = `${subject}-${topic}-${sub}`;
                const box = document.getElementById(id);
                if (box && box.checked) {
                    pool.push(...questions[subject][topic][sub]);
                }
            }
        }
    }

    return pool;
}

// Pick next question
function nextQuestion() {
    document.getElementById("feedback").textContent = "";
    document.getElementById("answers").innerHTML = "";
    selectedAnswer = null;

    const pool = getPool();
    if (pool.length === 0) {
        document.getElementById("questionText").textContent =
            "No topics selected.";
        return;
    }

    // Reset shown questions if all have been shown
    if (shownQuestions.length >= pool.length) {
        shownQuestions = [];
    }

    // Pick a question that hasn't been shown yet
    let remaining = pool.filter(q => !shownQuestions.includes(q));
    currentQuestion = remaining[Math.floor(Math.random() * remaining.length)];
    shownQuestions.push(currentQuestion);

    document.getElementById("questionText").textContent =
        currentQuestion.question;

    const mode = document.querySelector('input[name="mode"]:checked').value;

    if (mode === "normal") {
        showNormal();
    } else {
        showHard();
    }
}

// Display multiple choice buttons
function showNormal() {
    let opts = [...currentQuestion.options];
    opts.sort(() => Math.random() - 0.5);

    const area = document.getElementById("answers");

    opts.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;

        btn.onclick = () => {
            selectedAnswer = opt;
            document.querySelectorAll("#answers button")
                .forEach(b => b.style.border = "");
            btn.style.border = "2px solid black";
        };

        area.appendChild(btn);
    });
}

// Display text input for hard mode
function showHard() {
    const input = document.createElement("input");
    input.type = "text";
    input.id = "hardInput";
    input.style.width = "100%";
    document.getElementById("answers").appendChild(input);
}

// Check answer and give feedback
function checkAnswer() {
    if (!currentQuestion) return;

    const mode = document.querySelector('input[name="mode"]:checked').value;

    let userAnswer =
        mode === "normal"
            ? selectedAnswer
            : document.getElementById("hardInput").value.trim();

    if (!userAnswer) return;

    const feedback = document.getElementById("feedback");

    if (userAnswer.toLowerCase() === currentQuestion.correct.toLowerCase()) {
        feedback.textContent = "Correct.";
    } else {
        feedback.textContent =
            "Incorrect. Correct answer: " + currentQuestion.correct;
    }
}
</script>

</body>
</html>
