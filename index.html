<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Revision Program</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: auto;
            padding: 10px;
            line-height: 1.5;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        #menu {
            border: 1px solid #ccc;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        details {
            margin-bottom: 6px;
        }

        summary {
            font-weight: bold;
            cursor: pointer;
        }

        #modeBox {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        #answers button {
            display: block;
            width: 100%;
            margin: 6px 0;
            padding: 10px;
            font-size: 1em;
            border-radius: 6px;
            border: 1px solid #999;
            background-color: #f4f4f4;
            cursor: pointer;
        }

        #answers button:hover {
            background-color: #e0e0e0;
        }

        #buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        #buttons button {
            flex: 1 1 48%;
            padding: 10px;
            font-size: 1em;
            border-radius: 6px;
            border: 1px solid #999;
            background-color: #f4f4f4;
            cursor: pointer;
        }

        #buttons button:hover {
            background-color: #e0e0e0;
        }

        #feedback {
            margin-top: 10px;
            font-weight: bold;
        }

        input[type="text"] {
            padding: 10px;
            font-size: 1em;
            width: 100%;
            margin-top: 5px;
            box-sizing: border-box;
            border-radius: 6px;
            border: 1px solid #999;
        }

        .correct {
            background-color: #b6f7b6 !important;
        }

        .wrong {
            background-color: #f7b6b6 !important;
        }

        /* MOBILE OPTIMIZATION */
        @media (max-width: 600px) {
            h1 { font-size: 1.5em; }
            #modeBox { gap: 10px; }
            #buttons button { flex: 1 1 100%; }
        }
    </style>
</head>
<body>

<h1>Revision Program</h1>

<!-- TOPIC MENU -->
<div id="menu"></div>

<!-- MODE -->
<div id="modeBox">
    <label>
        <input type="radio" name="mode" value="normal" checked>
        Normal
    </label>
    <label>
        <input type="radio" name="mode" value="hard">
        Hard
    </label>
</div>

<!-- QUESTION -->
<h2 id="questionText"></h2>

<!-- ANSWERS -->
<div id="answers"></div>

<!-- BUTTONS -->
<div id="buttons">
    <button onclick="checkAnswer()">Check Answer</button>
    <button onclick="nextQuestion()">Next Question</button>
</div>

<p id="feedback"></p>

<script>
let questions = {};
let currentQuestion = null;
let selectedAnswer = null;
let shownQuestions = [];
let answered = false;

// Load questions
fetch("questions.json")
    .then(r => r.json())
    .then(data => {
        questions = data;
        buildMenu();
        nextQuestion();
    });

function buildMenu() {
    const menu = document.getElementById("menu");

    for (let subject in questions) {
        const subjectDetails = document.createElement("details");
        subjectDetails.open = true;

        const subjectSummary = document.createElement("summary");

        // Subject checkbox
        const subjectCb = document.createElement("input");
        subjectCb.type = "checkbox";
        subjectCb.checked = true;
        subjectCb.id = `subject-${subject}`;

        subjectCb.addEventListener("change", () => {
            // Check/uncheck all topic and subtopic checkboxes under this subject
            subjectDetails.querySelectorAll("input[type=checkbox]").forEach(cb => {
                cb.checked = subjectCb.checked;
            });
        });

        const subjectLabel = document.createElement("label");
        subjectLabel.htmlFor = subjectCb.id;
        subjectLabel.textContent = " " + subject;

        subjectSummary.appendChild(subjectCb);
        subjectSummary.appendChild(subjectLabel);
        subjectDetails.appendChild(subjectSummary);

        for (let topic in questions[subject]) {
            const topicDetails = document.createElement("details");

            const topicSummary = document.createElement("summary");

            // Topic checkbox
            const topicCb = document.createElement("input");
            topicCb.type = "checkbox";
            topicCb.checked = true;
            topicCb.id = `topic-${subject}-${topic}`;

            topicCb.addEventListener("change", () => {
                // Check/uncheck all subtopic checkboxes under this topic
                topicDetails.querySelectorAll("input[type=checkbox]").forEach(cb => {
                    cb.checked = topicCb.checked;
                });
            });

            const topicLabel = document.createElement("label");
            topicLabel.htmlFor = topicCb.id;
            topicLabel.textContent = " " + topic;

            topicSummary.appendChild(topicCb);
            topicSummary.appendChild(topicLabel);
            topicDetails.appendChild(topicSummary);

            for (let sub in questions[subject][topic]) {
                const id = `${subject}-${topic}-${sub}`;

                const cb = document.createElement("input");
                cb.type = "checkbox";
                cb.checked = true;
                cb.id = id;

                const label = document.createElement("label");
                label.htmlFor = id;
                label.textContent = " " + sub;

                topicDetails.appendChild(cb);
                topicDetails.appendChild(label);
                topicDetails.appendChild(document.createElement("br"));
            }

            subjectDetails.appendChild(topicDetails);
        }

        menu.appendChild(subjectDetails);
    }
}

function getPool() {
    let pool = [];

    for (let subject in questions) {
        for (let topic in questions[subject]) {
            for (let sub in questions[subject][topic]) {
                const id = `${subject}-${topic}-${sub}`;
                const box = document.getElementById(id);
                if (box && box.checked) {
                    pool.push(...questions[subject][topic][sub]);
                }
            }
        }
    }
    return pool;
}

function nextQuestion() {
    answered = false;
    selectedAnswer = null;

    document.getElementById("feedback").textContent = "";
    document.getElementById("answers").innerHTML = "";

    const pool = getPool();
    if (pool.length === 0) {
        document.getElementById("questionText").textContent =
            "No topics selected.";
        return;
    }

    if (shownQuestions.length >= pool.length) {
        shownQuestions = [];
    }

    const remaining = pool.filter(q => !shownQuestions.includes(q));
    currentQuestion = remaining[Math.floor(Math.random() * remaining.length)];
    shownQuestions.push(currentQuestion);

    document.getElementById("questionText").textContent =
        currentQuestion.question;

    const mode = document.querySelector('input[name="mode"]:checked').value;

    mode === "normal" ? showNormal() : showHard();
}

function showNormal() {
    const area = document.getElementById("answers");
    let opts = [...currentQuestion.options];
    opts.sort(() => Math.random() - 0.5);

    opts.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.dataset.answer = opt;

        btn.onclick = () => {
            if (answered) return;

            selectedAnswer = opt;
            document.querySelectorAll("#answers button")
                .forEach(b => b.style.border = "");
            btn.style.border = "2px solid black";
        };

        area.appendChild(btn);
    });
}

function showHard() {
    const input = document.createElement("input");
    input.type = "text";
    input.id = "hardInput";
    document.getElementById("answers").appendChild(input);
}

function checkAnswer() {
    if (!currentQuestion || answered) return;

    const mode = document.querySelector('input[name="mode"]:checked').value;
    const feedback = document.getElementById("feedback");

    if (mode === "normal") {
        if (!selectedAnswer) {
            feedback.textContent = "Please select an answer first.";
            return;
        }

        const buttons = document.querySelectorAll("#answers button");

        buttons.forEach(btn => {
            const value = btn.dataset.answer;

            if (value.toLowerCase() === currentQuestion.correct.toLowerCase()) {
                btn.classList.add("correct");
            }

            if (
                value.toLowerCase() === selectedAnswer.toLowerCase() &&
                value.toLowerCase() !== currentQuestion.correct.toLowerCase()
            ) {
                btn.classList.add("wrong");
            }
        });

        feedback.textContent =
            selectedAnswer.toLowerCase() === currentQuestion.correct.toLowerCase()
                ? "Correct."
                : "Incorrect.";

    } else {
        const input = document.getElementById("hardInput");
        if (!input || input.value.trim() === "") {
            feedback.textContent = "Please type an answer first.";
            return;
        }

        const userAnswer = input.value.trim();

        feedback.textContent =
            userAnswer.toLowerCase() === currentQuestion.correct.toLowerCase()
                ? "Correct."
                : "Incorrect. Correct answer: " + currentQuestion.correct;
    }

    answered = true;
}
</script>

</body>
</html>
